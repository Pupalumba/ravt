"use strict";
var core_1 = require("@angular/core");
var http_1 = require("@angular/http");
var backend_service_1 = require("../config/backend.service");
var product_service_errors_1 = require("../config/product.service.errors");
var product_1 = require("./product");
require("rxjs/add/operator/map");
var ProductListService = (function () {
    function ProductListService(http) {
        this.http = http;
    }
    ProductListService.prototype.load = function () {
        var headers = new http_1.Headers();
        headers.append("Content-Type", "application/json");
        return this.http.get(backend_service_1.BackendService.apiUrl + "api/products", {
            headers: headers
        })
            .map(function (res) { return res.json(); })
            .map(function (data) {
            var productList = [];
            data.forEach(function (product) {
                productList.push(new product_1.Product(product._id, product.name, product.type, product.description, product.price, product.highlight, product.date, product.expired, product.promotion, product.promotionPrice, product.images));
            });
            return productList;
        })
            .catch(product_service_errors_1.ErrorService.allProductsNotFound);
    };
    ProductListService.prototype.getById = function (id) {
        var url = backend_service_1.BackendService.apiUrl + "api/product/" + id;
        var headers = new http_1.Headers();
        headers.append("Content-Type", "application/json");
        return this.http.get(url, {
            headers: headers
        })
            .map(function (res) { return res.json(); })
            .map(function (data) {
            data = data[0];
            var product;
            product = new product_1.Product(data._id, data.name, data.type, data.description, data.price, data.highlight, data.date, data.expired, data.promotion, data.promotionPrice, data.images);
            return product;
        })
            .catch(product_service_errors_1.ErrorService.productNotFound);
    };
    ProductListService.prototype.getPromotions = function () {
        var headers = new http_1.Headers();
        headers.append("Content-Type", "application/json");
        return this.http.get(backend_service_1.BackendService.apiUrl + "api/products/promotions", {
            headers: headers
        })
            .map(function (res) { return res.json(); })
            .map(function (data) {
            var productList = [];
            data.forEach(function (product) {
                productList.push(new product_1.Product(product._id, product.name, product.type, product.description, product.price, product.highlight, product.date, product.expired, product.promotion, product.promotionPrice, product.images));
            });
            return productList;
        })
            .catch(product_service_errors_1.ErrorService.handleErrors);
    };
    ProductListService.prototype.getProductsOfType = function (type) {
        var url = backend_service_1.BackendService.apiUrl + "api/products/" + type;
        var headers = new http_1.Headers();
        headers.append("Content-Type", "application/json");
        return this.http.get(url, {
            headers: headers
        })
            .map(function (res) { return res.json(); })
            .map(function (data) {
            var productList = [];
            data.forEach(function (product) {
                productList.push(new product_1.Product(product._id, product.name, product.type, product.description, product.price, product.highlight, product.date, product.expired, product.promotion, product.promotionPrice, product.images));
            });
            return productList;
        })
            .catch(product_service_errors_1.ErrorService.categoryNotFound);
    };
    return ProductListService;
}());
ProductListService = __decorate([
    core_1.Injectable(),
    __metadata("design:paramtypes", [http_1.Http])
], ProductListService);
exports.ProductListService = ProductListService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjdC1saXN0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJwcm9kdWN0LWxpc3Quc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsc0NBQTJDO0FBQzNDLHNDQUE4QztBQUM5Qyw2REFBMkQ7QUFDM0QsMkVBQWdFO0FBQ2hFLHFDQUFvQztBQUNwQyxpQ0FBK0I7QUFHL0IsSUFBYSxrQkFBa0I7SUFDM0IsNEJBQW9CLElBQVU7UUFBVixTQUFJLEdBQUosSUFBSSxDQUFNO0lBQUcsQ0FBQztJQUVsQyxpQ0FBSSxHQUFKO1FBQ0ksSUFBSSxPQUFPLEdBQUcsSUFBSSxjQUFPLEVBQUUsQ0FBQztRQUM1QixPQUFPLENBQUMsTUFBTSxDQUFDLGNBQWMsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO1FBRW5ELE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxnQ0FBYyxDQUFDLE1BQU0sR0FBRyxjQUFjLEVBQUU7WUFDekQsT0FBTyxFQUFFLE9BQU87U0FDbkIsQ0FBQzthQUNHLEdBQUcsQ0FBQyxVQUFBLEdBQUcsSUFBSSxPQUFBLEdBQUcsQ0FBQyxJQUFJLEVBQUUsRUFBVixDQUFVLENBQUM7YUFDdEIsR0FBRyxDQUFDLFVBQUEsSUFBSTtZQUNMLElBQUksV0FBVyxHQUFHLEVBQUUsQ0FBQztZQUNyQixJQUFJLENBQUMsT0FBTyxDQUFDLFVBQUMsT0FBTztnQkFDakIsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLGlCQUFPLENBQ3hCLE9BQU8sQ0FBQyxHQUFHLEVBQ1gsT0FBTyxDQUFDLElBQUksRUFDWixPQUFPLENBQUMsSUFBSSxFQUNaLE9BQU8sQ0FBQyxXQUFXLEVBQ25CLE9BQU8sQ0FBQyxLQUFLLEVBQ2IsT0FBTyxDQUFDLFNBQVMsRUFDakIsT0FBTyxDQUFDLElBQUksRUFDWixPQUFPLENBQUMsT0FBTyxFQUNmLE9BQU8sQ0FBQyxTQUFTLEVBQ2pCLE9BQU8sQ0FBQyxjQUFjLEVBQ3RC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O1xyXG5pbXBvcnQgeyBIdHRwLCBIZWFkZXJzIH0gZnJvbSBcIkBhbmd1bGFyL2h0dHBcIjtcclxuaW1wb3J0IHsgQmFja2VuZFNlcnZpY2UgfSBmcm9tIFwiLi4vY29uZmlnL2JhY2tlbmQuc2VydmljZVwiO1xyXG5pbXBvcnQgeyBFcnJvclNlcnZpY2UgfSBmcm9tIFwiLi4vY29uZmlnL3Byb2R1Y3Quc2VydmljZS5lcnJvcnNcIjtcclxuaW1wb3J0IHsgUHJvZHVjdCB9IGZyb20gXCIuL3Byb2R1Y3RcIjtcclxuaW1wb3J0IFwicnhqcy9hZGQvb3BlcmF0b3IvbWFwXCI7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBQcm9kdWN0TGlzdFNlcnZpY2Uge1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwOiBIdHRwKSB7fVxyXG5cclxuICAgIGxvYWQoKSB7XHJcbiAgICAgICAgbGV0IGhlYWRlcnMgPSBuZXcgSGVhZGVycygpO1xyXG4gICAgICAgIGhlYWRlcnMuYXBwZW5kKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vanNvblwiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQoQmFja2VuZFNlcnZpY2UuYXBpVXJsICsgXCJhcGkvcHJvZHVjdHNcIiwge1xyXG4gICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzXHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLm1hcChyZXMgPT4gcmVzLmpzb24oKSlcclxuICAgICAgICAgICAgLm1hcChkYXRhID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBwcm9kdWN0TGlzdCA9IFtdO1xyXG4gICAgICAgICAgICAgICAgZGF0YS5mb3JFYWNoKChwcm9kdWN0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdExpc3QucHVzaChuZXcgUHJvZHVjdChcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdC5faWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3QubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdC50eXBlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0LmRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0LnByaWNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0LmhpZ2hsaWdodCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdC5kYXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0LmV4cGlyZWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3QucHJvbW90aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0LnByb21vdGlvblByaWNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0LmltYWdlcykpO1xyXG5cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb2R1Y3RMaXN0O1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goRXJyb3JTZXJ2aWNlLmFsbFByb2R1Y3RzTm90Rm91bmQpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEJ5SWQoaWQ6IHN0cmluZyl7XHJcbiAgICAgICAgbGV0IHVybCA9IEJhY2tlbmRTZXJ2aWNlLmFwaVVybCArIFwiYXBpL3Byb2R1Y3QvXCIgKyBpZDtcclxuICAgICAgICBsZXQgaGVhZGVycyA9IG5ldyBIZWFkZXJzKCk7XHJcbiAgICAgICAgaGVhZGVycy5hcHBlbmQoXCJDb250ZW50LVR5cGVcIiwgXCJhcHBsaWNhdGlvbi9qc29uXCIpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwsIHtcclxuICAgICAgICAgICAgaGVhZGVyczogaGVhZGVyc1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5tYXAocmVzID0+IHJlcy5qc29uKCkpXHJcbiAgICAgICAgICAgIC5tYXAoZGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICBkYXRhID0gZGF0YVswXTtcclxuICAgICAgICAgICAgICAgIGxldCBwcm9kdWN0O1xyXG4gICAgICAgICAgICAgICAgcHJvZHVjdCA9IG5ldyBQcm9kdWN0KGRhdGEuX2lkLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhLnR5cGUsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByaWNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaGlnaGxpZ2h0LFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGF0ZSxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhLmV4cGlyZWQsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wcm9tb3Rpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wcm9tb3Rpb25QcmljZSxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhLmltYWdlcyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvZHVjdDtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKEVycm9yU2VydmljZS5wcm9kdWN0Tm90Rm91bmQpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFByb21vdGlvbnMoKXtcclxuICAgICAgICBsZXQgaGVhZGVycyA9IG5ldyBIZWFkZXJzKCk7XHJcbiAgICAgICAgaGVhZGVycy5hcHBlbmQoXCJDb250ZW50LVR5cGVcIiwgXCJhcHBsaWNhdGlvbi9qc29uXCIpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldChCYWNrZW5kU2VydmljZS5hcGlVcmwgKyBcImFwaS9wcm9kdWN0cy9wcm9tb3Rpb25zXCIsIHtcclxuICAgICAgICAgICAgaGVhZGVyczogaGVhZGVyc1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5tYXAocmVzID0+IHJlcy5qc29uKCkpXHJcbiAgICAgICAgICAgIC5tYXAoZGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcHJvZHVjdExpc3QgPSBbXTtcclxuICAgICAgICAgICAgICAgIGRhdGEuZm9yRWFjaCgocHJvZHVjdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb2R1Y3RMaXN0LnB1c2gobmV3IFByb2R1Y3QoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3QuX2lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0Lm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3QudHlwZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdC5kZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdC5wcmljZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdC5oaWdobGlnaHQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3QuZGF0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdC5leHBpcmVkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0LnByb21vdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdC5wcm9tb3Rpb25QcmljZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdC5pbWFnZXNcclxuICAgICAgICAgICAgICAgICAgICApKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb2R1Y3RMaXN0O1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goRXJyb3JTZXJ2aWNlLmhhbmRsZUVycm9ycyk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0UHJvZHVjdHNPZlR5cGUodHlwZTogc3RyaW5nKXtcclxuICAgICAgICBsZXQgdXJsID0gQmFja2VuZFNlcnZpY2UuYXBpVXJsICsgXCJhcGkvcHJvZHVjdHMvXCIgKyB0eXBlO1xyXG4gICAgICAgIGxldCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKTtcclxuICAgICAgICBoZWFkZXJzLmFwcGVuZChcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybCwge1xyXG4gICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzXHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLm1hcChyZXMgPT4gcmVzLmpzb24oKSlcclxuICAgICAgICAgICAgLm1hcChkYXRhID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBwcm9kdWN0TGlzdCA9IFtdO1xyXG4gICAgICAgICAgICAgICAgZGF0YS5mb3JFYWNoKChwcm9kdWN0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdExpc3QucHVzaChuZXcgUHJvZHVjdChcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdC5faWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3QubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdC50eXBlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0LmRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0LnByaWNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0LmhpZ2hsaWdodCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdC5kYXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0LmV4cGlyZWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3QucHJvbW90aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0LnByb21vdGlvblByaWNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0LmltYWdlc1xyXG4gICAgICAgICAgICAgICAgICAgICkpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvZHVjdExpc3Q7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChFcnJvclNlcnZpY2UuY2F0ZWdvcnlOb3RGb3VuZCk7XHJcbiAgICB9XHJcblxyXG59Il19